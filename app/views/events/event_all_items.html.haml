= content_for :title, "All items of " + @event.name + " event"
%h3 All event items
%p= link_to 'Back to event', events_path
- if @items.empty?
	%p You don't have any items.
- else
	%hr
		%table{summary: "This table displays all items of the event #{@event.name}....", role: :grid}
			%caption All items of event #{@event.name}
			%thead
				%tr
					%th
					%th
					%th Date
					%th Name
					%th Description
					%th Base amount
					%th Exchange rate
					%th Foreign amount
					%th Payer
					%th Beneficiaries
					%th Cost per beneficiary
			%tfoot
				%tr
					%td{colspan: 11}
						* Amounts are rounded for display
						%br
						** E = Edit
						%br
						*** D = Delete
			%tbody
				- @items.each do |item|
					%tr
						%td= link_to("E", edit_item_path(item)) if current_user.can_update?(item)
						%td= link_to("D", item_path(item), method: :delete, data: {confirm: "Are you sure you want to delete item #{item.name} at the #{item.value_date.strftime('%d %b %Y')}?"}) if current_user.can_delete?(item)
						%td= item.value_date.strftime('%d %b %Y')
						%td= item.name
						%td= item.description
						%td= money_format(item.base_amount, item.base_currency)
						%td= item.exchange_rate
						%td= money_format(item.foreign_amount, item.foreign_currency)
						%td= item.payer.short_name
						%td.has-tip{"data-tooltip": true, :title => "#{item.beneficiaries.map{ |b| b.short_name }.join(', ')}"}= item.beneficiaries.count
						%td= money_format(item.cost_per_beneficiary, item.base_currency)
